{% extends 'base.html' %}
{% load static %}

{% block title %}{{ job.title }} - Job Portal{% endblock %}

{% block extra_css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- detail-template-v2 -->
<style>
    body {
        background: #f8fafc;
    }
    .page-hero {
        margin-top: 72px;
        padding: 64px 0 40px;
        background: linear-gradient(135deg, #0f172a 0%, #111827 40%, #0ea5e9 100%);
        color: #fff;
    }
    .page-hero h1 { font-weight: 700; }
    .page-hero .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        opacity: .9;
    }
    .job-shell {
        margin-top: 24px; /* keep cards aligned with hero without overlap */
    }

    /* Desktop: Force columns to stay side by side */
    @media (min-width: 992px) {
        .job-shell .row.g-4 {
            align-items: flex-start !important;
            display: flex !important;
            flex-wrap: nowrap !important;
            flex-direction: row !important;
        }
        
        .job-shell .col-lg-8 {
            flex: 0 0 66.66666667% !important;
            max-width: 66.66666667% !important;
            width: 66.66666667% !important;
            padding-right: 1rem !important;
            padding-left: 1rem !important;
        }
        
        .job-shell .col-lg-4 {
            flex: 0 0 33.33333333% !important;
            max-width: 33.33333333% !important;
            width: 33.33333333% !important;
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }
        
        .right-column-stack {
            margin-top: 88px !important;
        }
        
        .sidebar-card .card-body h5.job-details-heading,
        .job-details-heading {
            text-align: left !important;
        }
        
        .share-card .card-header h6.share-job-heading,
        .share-job-heading {
            text-align: left !important;
        }
    }
    /* On smaller screens, allow normal stacking */
    @media (max-width: 991.98px) {
        .job-shell .row.g-4 {
            margin-left: 0 !important;
            margin-right: 0 !important;
        }
        
        .job-shell .col-lg-8,
        .job-shell .col-lg-4 {
            padding-left: 0 !important;
            padding-right: 0 !important;
        }
    }
    
    /* Mobile-specific card alignment fixes (only for mobile, not tablet/desktop) */
    @media (max-width: 767.98px) {
        .job-shell {
            padding-left: 0.75rem !important;
            padding-right: 0.75rem !important;
        }
        
        .job-shell .row.g-4 {
            display: flex !important;
            flex-direction: column !important;
            gap: 0 !important;
        }
        
        .job-shell .col-lg-8 {
            order: 1;
            padding-left: 0 !important;
            padding-right: 0 !important;
            margin-bottom: 0 !important;
        }
        
        .job-shell .col-lg-4 {
            order: 2;
            padding-left: 0 !important;
            padding-right: 0 !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }
        
        .left-column-content {
            gap: 1.5rem !important;
            margin-bottom: 0 !important;
        }
        
        .right-column-stack {
            width: 100% !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            margin-top: 0 !important;
            display: flex !important;
            flex-direction: column !important;
            gap: 1.5rem !important;
        }
        
        /* Ensure section cards and sidebar cards have same styling on mobile */
        .section-card {
            margin-bottom: 1.5rem !important;
        }
        
        .section-card:last-of-type {
            margin-bottom: 1.5rem !important;
        }
        
        .sidebar-card,
        .share-card {
            width: 100% !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            align-self: stretch !important;
            margin-bottom: 0 !important;
        }
        
        .sidebar-card {
            border-radius: 14px !important;
            box-shadow: 0 10px 24px rgba(15,23,42,0.05) !important;
        }
        
        .share-card {
            border-radius: 14px !important;
            box-shadow: 0 10px 24px rgba(15,23,42,0.05) !important;
        }
        
        .sidebar-card .card-body {
            padding: 1.5rem !important;
        }
        
        .sidebar-card .card-body h5.job-details-heading,
        .job-details-heading {
            text-align: center !important;
            margin-bottom: 1.25rem !important;
        }
        
        .share-card .card-header h6.share-job-heading,
        .share-job-heading {
            text-align: center !important;
        }
        
        .sidebar-card .card-body form {
            width: 100% !important;
            margin-bottom: 1.25rem !important;
        }
        
        .sidebar-card .card-body form .btn {
            width: 100% !important;
            text-align: center !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
        }
        
        .share-card .card-header {
            padding: 1.25rem 1.5rem 0.75rem 1.5rem !important;
            text-align: center !important;
        }
        
        .share-card .card-header h6 {
            text-align: center !important;
        }
        
        .share-card .card-body {
            padding: 0.75rem 1.5rem 1.5rem 1.5rem !important;
        }
        
        .info-row {
            padding: 0.75rem 0 !important;
        }
    }
    /* Ensure right column stack stays together */
    .right-column-stack {
        display: flex;
        flex-direction: column;
        gap: 16px;
        width: 100%;
    }
    
    @media (min-width: 992px) {
        .right-column-stack {
            margin-top: 88px;
        }
    }
    
    @media (max-width: 991.98px) {
        .right-column-stack {
            margin-top: 0 !important;
        }
    }
    
    /* Mobile and Tablet Responsive Styles */
    @media (max-width: 991.98px) {
        .page-hero {
            margin-top: 56px !important;
            padding: 2rem 1rem !important;
        }
        
        .page-hero h1 {
            font-size: 1.75rem !important;
            line-height: 1.3;
            margin-bottom: 1rem !important;
        }
        
        .page-hero .meta {
            font-size: 0.85rem !important;
            gap: 0.5rem !important;
        }
        
        .page-hero .meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .pill {
            font-size: 0.8rem !important;
            padding: 6px 12px !important;
            gap: 4px !important;
        }
        
        .pill i {
            font-size: 0.75rem !important;
        }
        
        .sidebar-card {
            min-height: auto !important;
        }
        
        .sidebar-card .card-body {
            padding: 1.5rem !important;
        }
        
        .section-card {
            padding: 1.5rem !important;
            margin-bottom: 1.5rem !important;
        }
        
        .section-card h4 {
            font-size: 1.1rem !important;
            margin-bottom: 1rem !important;
        }
        
        .section-card .body-text {
            font-size: 0.9rem !important;
            line-height: 1.7 !important;
        }
        
        .skill-badge {
            font-size: 0.85rem !important;
            padding: 8px 14px !important;
        }
        
        .info-row {
            padding: 10px 0 !important;
            font-size: 0.9rem !important;
        }
        
        .info-row span:last-child {
            font-size: 0.85rem !important;
        }
        
        .share-card .card-body {
            padding: 1rem !important;
        }
        
        .share-card .card-header {
            padding: 1rem 1rem 0.5rem 1rem !important;
        }
        
        .share-card .btn {
            padding: 0.75rem !important;
            font-size: 0.9rem !important;
        }
        
        .related-job-card {
            padding: 1rem !important;
        }
    }
    
    @media (max-width: 767.98px) {
        .page-hero {
            padding: 1.5rem 0.75rem !important;
        }
        
        .page-hero h1 {
            font-size: 1.5rem !important;
        }
        
        .page-hero .d-flex.align-items-center.gap-3 {
            flex-wrap: wrap !important;
            gap: 0.5rem !important;
            margin-bottom: 1rem !important;
        }
        
        .pill {
            font-size: 0.75rem !important;
            padding: 5px 10px !important;
        }
        
        .col-md-4.text-md-end {
            text-align: center !important;
            margin-top: 1rem;
        }
        
        .btn-lg {
            width: 100% !important;
            padding: 0.875rem 1.5rem !important;
            font-size: 1rem !important;
        }
        
        .section-card {
            padding: 1.25rem !important;
            margin-bottom: 1.25rem !important;
        }
        
        .section-card h4 {
            font-size: 1rem !important;
        }
        
        .section-card .body-text {
            font-size: 0.875rem !important;
        }
        
        .sidebar-card .card-body {
            padding: 1.25rem !important;
        }
        
        .sidebar-card .card-body h5 {
            font-size: 1.1rem !important;
            margin-bottom: 1rem !important;
        }
        
        .info-row {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 0.25rem !important;
            padding: 0.75rem 0 !important;
        }
        
        .info-row span:last-child {
            text-align: left !important;
            font-weight: 600 !important;
        }
        
        .share-card .d-flex.gap-2 {
            flex-wrap: wrap !important;
        }
        
        .share-card .btn {
            flex: 1 1 calc(50% - 0.25rem) !important;
            min-width: calc(50% - 0.25rem) !important;
        }
        
        .related-job-card .d-flex.justify-content-between {
            flex-direction: column !important;
            gap: 0.75rem !important;
        }
        
        .related-job-card .btn-sm {
            width: 100% !important;
            margin-left: 0 !important;
        }
    }
    
    @media (max-width: 575.98px) {
        .page-hero {
            padding: 1.25rem 0.5rem !important;
        }
        
        .page-hero h1 {
            font-size: 1.35rem !important;
        }
        
        .page-hero .meta {
            font-size: 0.8rem !important;
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 0.5rem !important;
        }
        
        .pill {
            font-size: 0.7rem !important;
            padding: 4px 8px !important;
        }
        
        .section-card {
            padding: 1rem !important;
            border-radius: 12px !important;
        }
        
        .section-card h4 {
            font-size: 0.95rem !important;
        }
        
        .section-card h4 i {
            font-size: 0.9rem !important;
        }
        
        .section-card .body-text {
            font-size: 0.85rem !important;
        }
        
        .skill-badge {
            font-size: 0.8rem !important;
            padding: 6px 12px !important;
        }
        
        .sidebar-card .card-body {
            padding: 1rem !important;
        }
        
        .sidebar-card .card-body h5 {
            font-size: 1rem !important;
        }
        
        .info-row {
            font-size: 0.85rem !important;
            padding: 0.625rem 0 !important;
        }
        
        .share-card .card-body {
            padding: 0.875rem !important;
        }
        
        .share-card .btn {
            flex: 1 1 calc(50% - 0.25rem) !important;
            padding: 0.625rem !important;
            font-size: 0.85rem !important;
        }
        
        .share-card .btn i {
            font-size: 0.9rem !important;
        }
        
        .related-job-card {
            padding: 0.875rem !important;
        }
        
        .related-job-card h6 {
            font-size: 0.95rem !important;
        }
    }
    
    /* Tablet specific styles */
    @media (min-width: 768px) and (max-width: 991.98px) {
        .page-hero {
            padding: 2.5rem 1.5rem !important;
        }
        
        .page-hero h1 {
            font-size: 2rem !important;
        }
        
        .section-card {
            padding: 1.75rem !important;
        }
        
        .sidebar-card .card-body {
            padding: 1.75rem !important;
        }
    }
    .left-column-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
        width: 100%;
        height: 100%;
    }
    /* Make Job Details card compact */
    .sidebar-card {
        flex: 0 0 auto; /* Don't stretch, use natural height */
        display: flex;
        flex-direction: column;
        min-height: 485px;
    }
    .sidebar-card .card-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        padding: 28px !important; /* Reduced padding */
    }
    .sidebar-card .card-body form {
        margin-bottom: 16px !important; /* Reduced margin */
    }
    .sidebar-card .card-body h5 {
        margin-bottom: 16px !important; /* Reduced margin */
    }
    /* Share card stays below the Job Details card - compact */
    .share-card {
        flex-shrink: 0;
        margin-top: 16px;
    }
    .share-card .card-body {
        padding: 16px 20px !important; /* Reduced padding */
    }
    .share-card .card-header {
        padding: 16px 20px 8px 20px !important; /* Reduced padding */
    }
    /* Section cards maintain their natural height */
    .section-card {
        flex: 0 0 auto;
    }
    .card-soft {
        border: none;
        border-radius: 16px;
        box-shadow: 0 12px 30px rgba(15,23,42,0.08);
        transition: box-shadow 0.3s ease;
    }
    .card-soft:hover {
        box-shadow: 0 14px 36px rgba(15,23,42,0.12);
    }
    .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 8px 14px;
        background: #eef2ff;
        color: #312e81;
        font-weight: 600;
        font-size: 0.9rem;
    }
    .skill-badge {
        display: inline-block;
        padding: 10px 16px;
        background: #e2e8f0;
        color: #0f172a;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }
    .skill-badge:hover {
        background: #cbd5e1;
        transform: translateY(-2px);
    }
    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0; /* Reduced padding for compact look */
        border-bottom: 1px solid #e2e8f0;
        font-weight: 600;
        color: #0f172a;
    }
    .info-row:first-child {
        padding-top: 0;
    }
    .info-row:last-child { 
        border-bottom: none;
        padding-bottom: 0;
    }
    .info-row span:first-child {
        color: #64748b;
        font-weight: 500;
    }
    .info-row span:last-child {
        color: #0f172a;
        font-weight: 600;
        text-align: right;
    }
    .btn-primary {
        background: linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%);
        border: none;
        font-weight: 700;
    }
    .btn-outline-secondary {
        border-color: #cbd5e1;
        color: #0f172a;
    }
    .related-job-card {
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 18px;
        transition: transform .2s, box-shadow .2s;
        background: #fff;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    .related-job-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 24px rgba(15,23,42,0.08);
    }
    .section-card {
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 14px;
        box-shadow: 0 10px 24px rgba(15,23,42,0.05);
        padding: 28px;
        margin-bottom: 24px;
        transition: box-shadow 0.3s ease;
    }
    .section-card {
        flex: 0 0 auto;
    }
    .section-card:hover {
        box-shadow: 0 12px 32px rgba(15,23,42,0.08);
    }
    .section-card h4 {
        font-weight: 700;
        margin-bottom: 16px;
        color: #0f172a;
        font-size: 1.25rem;
        display: flex;
        align-items: center;
    }
    .section-card .body-text {
        color: #475569;
        line-height: 1.8;
        font-size: 0.95rem;
    }
    .section-card .body-text p {
        margin-bottom: 1rem;
    }
    .section-card .body-text p:last-child {
        margin-bottom: 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero -->
<section class="page-hero">
    <div class="container">
        <div class="row g-4 align-items-center">
            <div class="col-12 col-md-8">
                <div class="d-flex align-items-center flex-wrap gap-2 gap-md-3 mb-3">
                    <div class="pill"><i class="fas fa-building"></i> <span class="d-none d-sm-inline">{{ job.company.name }}</span><span class="d-sm-none">{{ job.company.name|truncatewords:2 }}</span></div>
                    <div class="pill"><i class="fas fa-map-marker-alt"></i> {{ job.location }}</div>
                    <div class="pill"><i class="fas fa-briefcase"></i> {{ job.get_work_mode_display }}</div>
                    <div class="pill"><i class="far fa-clock"></i> {{ job.get_job_type_display }}</div>
                </div>
                <h1 class="mb-3" data-job-title="{{ job.title }}" data-job-id="{{ job.id }}" data-company-name="{{ job.company.name }}">{{ job.title }}</h1>
                <div class="meta">
                    <span><i class="fas fa-calendar-alt me-2"></i>Posted {{ job.created_at|timesince }} ago</span>
                    {% if job.deadline %}<span><i class="fas fa-hourglass-half me-2"></i>Deadline {{ job.deadline|date:"M d, Y" }}</span>{% endif %}
                </div>
            </div>
            <div class="col-12 col-md-4 text-md-end mt-3 mt-md-0">
                {% if user.is_authenticated and user.is_job_seeker and not has_applied %}
                    <a href="{% url 'jobs:apply' job.id %}" class="btn btn-primary btn-lg w-100 w-md-auto px-4">Apply Now</a>
                {% elif has_applied %}
                    <button class="btn btn-success btn-lg w-100 w-md-auto px-4" disabled>Already Applied</button>
                {% else %}
                    <button class="btn btn-primary btn-lg w-100 w-md-auto px-4" data-bs-toggle="modal" data-bs-target="#loginModal">Login to Apply</button>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<div class="container job-shell pb-5">
    <div class="row g-4">
        <div class="col-12 col-lg-8">
            <div class="left-column-content">
                <div class="d-flex flex-wrap gap-2 mb-3">
                    <span class="pill"><i class="fas fa-user-tie"></i> {{ job.get_experience_level_display }}</span>
                    {% if job.salary_min %}
                    <span class="pill"><i class="fas fa-dollar-sign"></i> <span class="d-none d-sm-inline">{{ job.salary_currency }} {{ job.salary_min|floatformat:0 }} - {{ job.salary_max|floatformat:0 }}</span><span class="d-sm-none">{{ job.salary_currency }} {{ job.salary_min|floatformat:0 }}-{{ job.salary_max|floatformat:0 }}</span></span>
                    {% endif %}
                </div>

                <div class="section-card description-card">
                    <h4><i class="fas fa-file-alt me-2 text-primary"></i>Job Description</h4>
                    <div class="body-text">
                        {{ job.description|linebreaks }}
                    </div>
                </div>

                <div class="section-card requirements-card">
                    <h4><i class="fas fa-list-check me-2 text-primary"></i>Requirements</h4>
                    <div class="body-text">
                        {{ job.requirements|linebreaks }}
                    </div>
                </div>

                {% if job.skills_required %}
                <div class="section-card skills-card">
                    <h4><i class="fas fa-tools me-2 text-primary"></i>Required Skills</h4>
                    <div class="d-flex flex-wrap gap-2" style="margin-top: 8px;">
                        {% for skill in job.skills_required %}
                            <span class="skill-badge">{{ skill }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            {% if related_jobs %}
            <div class="card card-soft">
                <div class="card-header bg-white border-0 px-4 pt-4 pb-3">
                    <h5 class="mb-0" style="font-weight: 700; color: #0f172a; font-size: 1.25rem;"><i class="fas fa-th-large me-2 text-primary"></i>Related Jobs</h5>
                </div>
                <div class="card-body pt-2 pb-4 px-4">
                    <div class="row g-3">
                        {% for related_job in related_jobs %}
                        <div class="col-12 col-md-6">
                            <div class="related-job-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1" style="font-weight: 600;">
                                            <a href="{% url 'jobs:detail' related_job.id %}" class="text-decoration-none text-dark">{{ related_job.title }}</a>
                                        </h6>
                                        <div class="text-muted small mb-1">{{ related_job.company.name }}</div>
                                        <div class="small text-muted"><i class="fas fa-map-marker-alt me-1"></i>{{ related_job.location }}</div>
                                    </div>
                                    <a href="{% url 'jobs:detail' related_job.id %}" class="btn btn-sm btn-outline-primary ms-2" style="white-space: nowrap;">View</a>
                                </div>
                                <div class="mt-auto d-flex gap-2 flex-wrap">
                                    <span class="badge bg-secondary">{{ related_job.get_work_mode_display }}</span>
                                    <span class="badge bg-info text-dark">{{ related_job.get_job_type_display }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
            </div>
        </div>

        <div class="col-12 col-lg-4 right-column-stack">
            <div class="card card-soft sidebar-card">
                <div class="card-body">
                    {% if user.is_authenticated and user.is_job_seeker %}
                        <form method="POST" action="{% url 'jobs:save' job.id %}" class="d-grid mb-4">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-secondary">
                                <i class="far fa-bookmark me-2"></i>{% if is_saved %}Unsave Job{% else %}Save Job{% endif %}
                            </button>
                        </form>
                    {% endif %}
                    <h5 class="mb-4 job-details-heading" style="font-weight: 700; color: #0f172a; font-size: 1.25rem;">Job Details</h5>
                    <div class="info-row"><span>Experience</span><span>{{ job.get_experience_level_display }}</span></div>
                    {% if job.salary_min %}<div class="info-row"><span>Salary</span><span>{{ job.salary_currency }} {{ job.salary_min|floatformat:0 }} - {{ job.salary_max|floatformat:0 }}</span></div>{% endif %}
                    <div class="info-row"><span>Posted</span><span>{{ job.created_at|date:"M d, Y" }}</span></div>
                    <div class="info-row"><span>Views</span><span>{{ job.views }}</span></div>
                    <div class="info-row"><span>Applications</span><span>{{ job.application_count }}</span></div>
                    {% if job.deadline %}<div class="info-row"><span>Deadline</span><span>{{ job.deadline|date:"M d, Y" }}</span></div>{% endif %}
                </div>
            </div>

            <div class="card card-soft share-card">
                <div class="card-header bg-white border-0 px-4 pt-4 pb-2">
                    <h6 class="mb-0 share-job-heading" style="font-weight: 700; color: #0f172a; font-size: 1.1rem;"><i class="fas fa-share-alt me-2 text-primary"></i>Share this job</h6>
                </div>
                <div class="card-body pb-4 px-4 pt-2">
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary flex-fill" onclick="shareJob('facebook')" style="padding: 10px;"><i class="fab fa-facebook-f"></i></button>
                        <button class="btn btn-outline-info flex-fill" onclick="shareJob('twitter')" style="padding: 10px;"><i class="fab fa-twitter"></i></button>
                        <button class="btn btn-outline-primary flex-fill" onclick="shareJob('linkedin')" style="padding: 10px;"><i class="fab fa-linkedin-in"></i></button>
                        <button class="btn btn-outline-secondary flex-fill" onclick="copyJobLink()" style="padding: 10px;"><i class="fas fa-link"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function shareJob(platform) {
    const url = window.location.href;
    const title = '{{ job.title }}';
    let shareUrl = '';
    
    switch(platform) {
        case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            break;
        case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
            break;
        case 'linkedin':
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;
            break;
    }
    
    if (shareUrl) {
        window.open(shareUrl, '_blank', 'width=600,height=400');
    }
}

function copyJobLink() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        alert('Job link copied to clipboard!');
    });
}

// Save/Unsave job in localStorage for anonymous users
(function() {
    'use strict';
    document.addEventListener('DOMContentLoaded', function() {
        var jobId = {{ job.id }};
        var jobTitle = '{{ job.title|escapejs }}';
        var companyName = '{{ job.company.name|escapejs }}';
        var jobUrl = window.location.pathname;
        var isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};

        // Track job view and add to recent jobs
        if (jobId && typeof LocalStorageManager !== 'undefined') {
            LocalStorageManager.trackJobView(jobId);
            LocalStorageManager.addRecentJob(jobId, jobTitle, companyName, jobUrl);
        }

        // Handle save/unsave for anonymous users
        if (!isAuthenticated) {
            var saveButton = document.querySelector('button[data-bs-target="#loginModal"]');
            if (saveButton && typeof LocalStorageManager !== 'undefined') {
                // Check if job is already saved in localStorage
                if (LocalStorageManager.isJobSaved(jobId)) {
                    // Could show a visual indicator here
                }
            }
        }

        // Sync saved jobs when user logs in (if they have saved jobs in localStorage)
        if (isAuthenticated && typeof LocalStorageManager !== 'undefined') {
            LocalStorageManager.syncSavedJobsWithBackend();
        }
    });
})();
</script>
{% endblock %}
